AWX API DEMO 通知機能の検討
===========================

申請の作成・作業担当者の割り当て・状態変更などの重要なイベントが発生した際に、関係者が気付くための機能が必要となる。

本ドキュメントでは、該当のイベントが発生した際にメッセージ通知を送ることで実現することを検討する。

* 通知機能の概要

  申請の作成時や内容の変更時などに、申請者や業担当者・管理者に対して、メールやTeamsを利用してメッセージを通知する。

* 通知先のユーザ

  申請者と作業担当者・管理者への通知については、特性に応じた方式を検討する必要がある。

| 通知先のユーザ | 特性 |
| --------------- | ---------------------------------- |
| 申請者 | （変更対象の仮想マシンなどの）利用者とその関係者のみに通知を行う。<br/>異なる案件の利用者などに、関係のない通知を送ってはならない。 |
| 作業担当者・管理者 | IaaSチームの関係者（複数人）に対して、通知を行う。 |


* 通知の方法（例）

  通知先のユーザ特性から、複数人を対象とした通知方法にTeams通知もしくはメール通知、個人のみを対象とした通知方法にメール通知が選択可能となる。

| 通知の方法 | 概要 |
| --------------- | ---------------------------------- |
| Teams通知 | Teamsのチャンネルを対象として、メッセージ通知が可能である。個人のチャットに対して、通知を行うことはできない。<br/>Teamsの提供するIncoming Webhookの有効化及び該当URLへの接続が必要となる。 |
| メール通知 | メールアドレスに対して、個人・複数人（メーリングリスト）を問わずにメッセージ通知が可能である。<br/>SMTPサーバへの接続が必要となる。 |



* 通知対象イベントと通知先

| 通知対象イベント | 申請者への通知 | 作業担当者・管理者への通知 |
| --------------------------------- | --------- | ----------- |
| 申請の作成 | ✔︎ | ✔︎ |
| 申請内容の参照（自身の申請のみ） | | |
| 申請内容の参照（全て） | | |
| 申請内容の変更 | | ✔︎ |
| 申請の状態変更（完了のみ） | ✔︎ | ✔︎ |
| 申請の状態変更（全て） | | ✔︎ |
| 申請内容の実行 | | ✔︎ |
| 申請の複製 | | ✔︎ |
| 申請の削除 | | ✔︎ |
| 作業担当者の割り当て | | ✔︎ |
| 操作履歴の参照（自身の操作のみ） | | |
| 操作履歴の参照（全て） | | |
| 個人用設定の変更 | | |
| グローバル設定の変更 | | ✔︎ |

* 通知メッセージの内容

| フィールド | 必須 | 概要 |
| --------------- | --- | ---------------------------------- |
| 時刻 | ✔︎ | 操作が行われた時刻 |
| ユーザ名 | | 操作を行ったユーザ名（作業担当者・管理者への通知のみ） |
| イベント種別 | ✔︎ | 通知対象イベント |
| ステータス | ✔︎ | 操作結果（成功・失敗・不明） |
| 依頼ID | | 関連する依頼ID（申請に関する操作の場合のみ） |
| 依頼内容 | | 依頼内容（申請に関する操作の場合のみ） |
| リリース希望日 | | リリース希望日（申請に関する操作の場合のみ） |
| 概要 | ✔︎ | 操作内容の概要 |
| 詳細 | | 操作内容の追加情報 |